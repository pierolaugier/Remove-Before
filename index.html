<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Reserve your bracelet ‚Äî Minimal</title>

  <style>
    :root{
      --bg: #f5f5f7;
      --card: #ffffff;
      --shadow-outer: 0 10px 30px rgba(29,29,31,0.06);
      --btn-red: #fd0000;
      --btn-red-hover: #e60000;
      --btn-border: rgba(0,0,0,0.12);
      --cta-width: 360px;
      --fade-ms: 120ms;
      --toast-bg: rgba(17,24,39,0.95);
      --toast-duration: 2200ms;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      background:var(--bg);
      color:#1d1d1f;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
    }

    .card{
      width:min(720px,92vw);
      background:var(--card);
      border-radius:20px;
      padding:48px;
      box-shadow:var(--shadow-outer);
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:60vh;
      position:relative;
      text-align:center;
    }

    .button-wrap{
      position:relative;
      display:flex;
      gap:18px;
      align-items:center;
      justify-content:center;
      width:100%;
      margin:0 auto;
      max-width:var(--cta-width);
    }

    .cta{
      background:var(--btn-red);
      border:1px solid var(--btn-border);
      padding:14px 18px;
      border-radius:44px;
      color:#fff;
      font-weight:600;
      font-size:18px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:14px;
      box-shadow:0 8px 20px rgba(253,0,0,0.12),inset 0 -1px 0 rgba(255,255,255,0.06);
      transition:background .14s ease,box-shadow .14s ease,transform .08s ease;
      backdrop-filter:blur(6px) saturate(120%);
      position:relative;
      overflow:visible;
      user-select:none;
      width:var(--cta-width);
      box-sizing:border-box;
    }

    .cta:active{transform:none;box-shadow:0 6px 14px rgba(0,0,0,0.08);}
    .cta:hover{background:var(--btn-red-hover);box-shadow:0 12px 30px rgba(230,0,0,0.12);}
    .cta:focus{outline:none;box-shadow:0 0 0 4px rgba(253,0,0,0.08);}

    .cta .label{
      color:#fff;
      font-size:16px;
      line-height:1.2;
      white-space:nowrap;
      display:block;
      text-align:center;
      width:100%;
      padding:0 6px;
      box-sizing:border-box;
      transition:opacity var(--fade-ms) ease,transform var(--fade-ms) ease;
      opacity:1;
    }
    .cta .label.hidden{opacity:0;transform:translateY(-6px);pointer-events:none;}
    .cta .label.small{font-size:14px;white-space:normal;word-break:break-word;hyphens:auto;}

    .insta-inline{
      position:absolute;
      left:0;
      top:50%;
      transform:translateY(-50%);
      width:100%;
      border-radius:44px;
      height:calc(100% - 4px);
      padding:14px 18px;
      background:transparent;
      border:1px solid rgba(255,255,255,0);
      color:#fff;
      font-size:16px;
      text-align:center;
      outline:none;
      opacity:0;
      pointer-events:none;
      transition:opacity var(--fade-ms) ease,transform var(--fade-ms) ease;
    }
    .insta-inline.show{opacity:1;pointer-events:auto;transform:translateY(-50%) translateY(0);}
    .insta-inline::placeholder{color:rgba(255,255,255,0.9);}

    .toast{
      position:fixed;
      left:50%;
      bottom:28px;
      transform:translateX(-50%) translateY(12px);
      background:var(--toast-bg);
      color:#fff;
      padding:10px 14px;
      border-radius:10px;
      font-size:14px;
      box-shadow:0 8px 30px rgba(2,6,23,0.4);
      opacity:0;
      pointer-events:none;
      transition:opacity 200ms ease,transform 260ms cubic-bezier(.2,.9,.2,1);
      z-index:9999;
      display:flex;
      gap:8px;
      align-items:center;
    }
    .toast.show{opacity:1;pointer-events:auto;transform:translateX(-50%) translateY(0);}
    .toast .dot{
      width:8px;
      height:8px;
      border-radius:50%;
      background:#10b981;
      box-shadow:0 0 8px rgba(16,185,129,0.6);
    }

    #storage-note{
      margin-top:12px;
      font-size:13px;
      color:#fff;
      text-align:left;
      position:absolute;
      left:24px;
      bottom:24px;
      pointer-events:none;
    }

    .modal-backdrop{position:fixed;inset:0;display:none;}
    .modal-backdrop.show{display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);}
    .modal{background:#fff;padding:18px;border-radius:12px;box-shadow:0 18px 60px rgba(0,0,0,0.35);min-width:320px;}

    @media(max-width:520px){
      :root{--cta-width:240px;--fade-ms:100ms;--toast-duration:2000ms;}
      .card{padding:28px;min-height:52vh}
      .cta{padding:12px 14px;font-size:15px}
      .insta-inline{padding:12px 14px;font-size:15px;height:calc(100% - 4px);}
      .cta .label.small{font-size:13px;}
    }
  </style>
</head>
<body>
  <main class="card" role="main" aria-label="R√©server le bracelet">
    <div class="button-wrap" style="--cta-width:360px;">
      <button id="clicker" class="cta" aria-label="Reserve your bracelet for free" type="button">
        <span class="label" id="btn-label">Reserve your bracelet for free</span>
      </button>
      <input id="inline-insta" class="insta-inline" type="text" autocomplete="username"
             placeholder="@instagram ID" aria-label="Nom de compte Instagram" />
    </div>

    <div id="storage-note" aria-hidden="true">
      Donn√©es stock√©es dans <code>localStorage</code> du navigateur sous la cl√© <code>compteur-clics-total</code>.
    </div>
  </main>

  <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true">
    <div class="dot" aria-hidden="true"></div>
    <div id="toast-text">Reserved</div>
  </div>

  <div id="admin-modal-backdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="admin-title">
      <h2 id="admin-title">Admin ‚Äî Total des clics</h2>
      <p>Voici la valeur stock√©e localement (cl√© : <code>compteur-clics-total</code>) pour ce navigateur.</p>
      <div style="display:flex;gap:8px;align-items:center;justify-content:space-between;">
        <div id="admin-total" style="font-weight:700;">0</div>
        <div style="display:flex;gap:8px;">
          <button id="copy-total" class="btn" style="background:#111827;color:#fff;border:none;padding:8px 10px;border-radius:8px;">Copier</button>
          <button id="close-modal" class="btn secondary" style="background:transparent;color:#111827;border:1px solid rgba(17,24,39,0.08);padding:8px 10px;border-radius:8px;">Fermer</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const STORAGE_KEY='compteur-clics-total';
      const FEEDBACK_DELAY_MS=700;
      const btn=document.getElementById('clicker');
      const labelSpan=document.getElementById('btn-label');
      const inlineInsta=document.getElementById('inline-insta');
      const toast=document.getElementById('toast');
      const toastText=document.getElementById('toast-text');
      const adminBackdrop=document.getElementById('admin-modal-backdrop');
      const adminTotalEl=document.getElementById('admin-total');
      const copyBtn=document.getElementById('copy-total');
      const closeBtn=document.getElementById('close-modal');
      const ADMIN_TOKEN='change-me-secret-token';
      const ADMIN_URL_PARAM='admin';

      function readTotal(){
        try{
          const raw=localStorage.getItem(STORAGE_KEY);
          const n=parseInt(raw,10);
          return Number.isFinite(n)&&n>=0?n:0;
        }catch(e){return 0;}
      }
      function writeTotal(n){
        try{localStorage.setItem(STORAGE_KEY,String(n));}catch(e){}
      }

      let total=readTotal();
      let doneFlag=false;
      let instaMode=false;
      let toastTimer=null;
      let labelTimer=null;

      function enterInstaMode(){
        labelSpan.classList.add('hidden');
        inlineInsta.classList.add('show');
        instaMode=true;
        setTimeout(()=>inlineInsta.focus(),80);
      }

      function exitInstaMode(cancel=true){
        inlineInsta.classList.remove('show');
        labelSpan.classList.remove('hidden');
        instaMode=false;
        inlineInsta.value='';
        if(!cancel)inlineInsta.blur();
      }

      function showToast(message){
        clearTimeout(toastTimer);
        toastText.textContent=message;
        toast.classList.add('show');
        toastTimer=setTimeout(()=>{
          toast.classList.remove('show');
        },parseInt(getComputedStyle(document.documentElement).getPropertyValue('--toast-duration'))||2200);
      }

      // NE PLUS incr√©menter ici !
      function confirmInsta(){
        if(!doneFlag){
          doneFlag=true;
          // INCR√âMENTATION supprim√©e !
        }
        showToast('Reserved ‚úì');
        clearTimeout(labelTimer);
        labelTimer=setTimeout(()=>{
          const newText='Hihaaa ! You are set for the waiting list. üòé';
          labelSpan.textContent=newText;
          labelSpan.classList.add('small');
          btn.setAttribute('aria-label',newText);
          inlineInsta.disabled=true;
          exitInstaMode(false);
        },FEEDBACK_DELAY_MS);
      }

      // INCR√âMENTATION sur le premier clic
      btn.addEventListener('click',()=>{
        if(doneFlag)return;
        if(!instaMode){
          total = Math.max(0, total + 1);
          writeTotal(total);
          doneFlag = true;
          enterInstaMode();
        }else{
          inlineInsta.focus();
        }
      });

      inlineInsta.addEventListener('keydown',(ev)=>{
        if(ev.key==='Enter'){ev.preventDefault();confirmInsta();}
        else if(ev.key==='Escape'){ev.preventDefault();exitInstaMode(true);}
      });

      function showAdminModal(){
        total=readTotal();
        adminTotalEl.textContent=total.toLocaleString('fr-FR');
        adminBackdrop.classList.add('show');
        adminBackdrop.setAttribute('aria-hidden','false');
      }
      function hideAdminModal(){
        adminBackdrop.classList.remove('show');
        adminBackdrop.setAttribute('aria-hidden','true');
      }
      function tryAuthWithToken(token){
        if(!token)return false;
        if(token===ADMIN_TOKEN){showAdminModal();return true;}
        return false;
      }

      (function checkUrlParam(){
        try{
          const params=new URLSearchParams(window.location.search);
          const t=params.get(ADMIN_URL_PARAM);
          if(t&&tryAuthWithToken(t)){
            const url=new URL(window.location.href);
            url.searchParams.delete(ADMIN_URL_PARAM);
            window.history.replaceState({},document.title,url.toString());
          }
        }catch(e){}
      })();

      window.addEventListener('keydown',(ev)=>{
        const isMac=navigator.platform.toUpperCase().indexOf('MAC')>=0;
        const mod=isMac?ev.metaKey:ev.ctrlKey;
        if(mod&&ev.shiftKey&&ev.key.toLowerCase()==='a'){
          ev.preventDefault();
          const token=prompt('Admin token :');
          if(token){if(!tryAuthWithToken(token))alert('Token invalide.');}
        }
      });

      copyBtn.addEventListener('click',async()=>{
        try{
          await navigator.clipboard.writeText(String(readTotal()));
          copyBtn.textContent='Copi√©';
          setTimeout(()=>copyBtn.textContent='Copier',1500);
        }catch(e){alert('Impossible de copier dans le presse-papiers.');}
      });
      closeBtn.addEventListener('click',hideAdminModal);
      adminBackdrop.addEventListener('click',(ev)=>{if(ev.target===adminBackdrop)hideAdminModal();});

      window.addEventListener('storage',(ev)=>{
        if(ev.key===STORAGE_KEY){
          total=readTotal();
          if(adminBackdrop.classList.contains('show')){
            adminTotalEl.textContent=total.toLocaleString('fr-FR');
          }
        }
      });
    })();
  </script>
</body>
</html>

